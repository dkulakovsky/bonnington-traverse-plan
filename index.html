<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bonnington Ski Traverse Plan | Winter 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutral Harmony -->
    <!-- Application Structure Plan: A tabbed, single-page dashboard application. The structure prioritizes user task-flow over the linear format of the source report. A main 'Dashboard' provides an at-a-glance overview (stats, skills, weather). Subsequent tabs ('The Route', 'The Risks', 'The Gear', 'The Logistics') allow users to dive into specific planning areas without overwhelming them. This non-linear, component-based structure is better for interactive exploration and quick information retrieval than a long scrolling document. Key interactions include tabbed navigation for daily itineraries, toggleable cards for risk details, and an interactive chart for weather context. -->
    <!-- Visualization & Content Choices: 
        - Traverse Vitals (Distance, Duration, ATES): Goal: Inform quickly. Method: Large typographic stat cards (HTML/CSS). Interaction: None. Justification: High visibility for core stats.
        - Mid-Winter Temps: Goal: Show change/range. Method: Bar Chart (Chart.js). Interaction: Tooltips on hover. Justification: Visualizes the significant temperature swing more effectively than text alone.
        - Daily Itinerary: Goal: Organize route details. Method: HTML/CSS vertical timeline for each day within a tabbed view. Interaction: Click tabs to view day. Justification: Breaks the 4-day journey into manageable, focused chunks.
        - Risk Details (Avalanche/Bail-outs): Goal: Inform without overwhelming. Method: Toggleable accordion cards (HTML/JS). Interaction: Click to expand/collapse. Justification: Hides dense text, allowing users to focus on one critical risk at a time.
        - Gear List: Goal: Organize equipment. Method: Categorized checklist (HTML/CSS). Interaction: Visual-only checkmarks. Justification: Feels more interactive and is easier to scan than a simple list.
        - Logistics (Huts/Shuttle): Goal: Compare options. Method: Info cards in a grid layout. Interaction: None. Justification: Standard, clear UI pattern for comparing discrete options.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
            color: #334155; /* slate-700 */
        }
        .nav-link {
            transition: all 0.2s ease-in-out;
            border-bottom: 2px solid transparent;
        }
        .nav-link.active {
            border-bottom-color: #f97316; /* orange-500 */
            color: #0f172a; /* slate-900 */
        }
        .tab-button.active {
            background-color: #1e293b; /* slate-800 */
            color: #f1f5f9; /* slate-100 */
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 350px;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }
        .gemini-loader {
            display: none;
        }
        .gemini-output {
            white-space: pre-wrap;
            background-color: #f1f5f9;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            line-height: 1.5;
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 border-b border-slate-200">
        <nav class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <h1 class="text-xl font-bold text-slate-800">Bonnington Traverse</h1>
                <div class="hidden md:flex items-center space-x-4 lg:space-x-6">
                    <a href="#dashboard" class="nav-link font-medium text-slate-600 hover:text-slate-900 pb-1">Dashboard</a>
                    <a href="#route" class="nav-link font-medium text-slate-600 hover:text-slate-900 pb-1">The Route</a>
                    <a href="#risks" class="nav-link font-medium text-slate-600 hover:text-slate-900 pb-1">The Risks</a>
                    <a href="#gear" class="nav-link font-medium text-slate-600 hover:text-slate-900 pb-1">The Gear</a>
                    <a href="#logistics" class="nav-link font-medium text-slate-600 hover:text-slate-900 pb-1">The Logistics</a>
                </div>
                <div class="md:hidden">
                    <select id="mobile-nav" class="w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500">
                        <option value="#dashboard">Dashboard</option>
                        <option value="#route">The Route</option>
                        <option value="#risks">The Risks</option>
                        <option value="#gear">The Gear</option>
                        <option value="#logistics">The Logistics</option>
                    </select>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-8">

        <!-- Dashboard Section -->
        <section id="dashboard" class="content-section active">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-900">Bonnington Traverse: Trip Plan</h2>
                <p class="mt-2 text-lg text-slate-600">An interactive guide for our self-led expedition in Jan/Feb 2026.</p>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 mb-8">
                <h3 class="text-xl font-semibold text-slate-800 mb-4">At a Glance: Traverse Vitals</h3>
                <p class="text-slate-600 mb-6">This section provides the key statistics for the traverse. It's a non-glaciated route, but its primary challenges are complex navigation and a notoriously tricky Kootenay-Boundary snowpack, not raw physical output. The ATES rating underscores the need for constant, careful decision-making.</p>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div class="bg-slate-100 p-4 rounded-lg">
                        <div class="text-3xl font-bold text-orange-600">~48 km</div>
                        <div class="text-sm font-medium text-slate-500 mt-1">Total Distance</div>
                    </div>
                    <div class="bg-slate-100 p-4 rounded-lg">
                        <div class="text-3xl font-bold text-orange-600">4 Days</div>
                        <div class="text-sm font-medium text-slate-500 mt-1">Standard Duration</div>
                    </div>
                    <div class="bg-slate-100 p-4 rounded-lg">
                        <div class="text-3xl font-bold text-orange-600">Challenging</div>
                        <div class="text-sm font-medium text-slate-500 mt-1">ATES Rating</div>
                    </div>
                    <div class="bg-slate-100 p-4 rounded-lg">
                        <div class="text-3xl font-bold text-orange-600">Non-Glaciated</div>
                        <div class="text-sm font-medium text-slate-500 mt-1">Terrain Type</div>
                    </div>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <h3 class="text-xl font-semibold text-slate-800 mb-4">Team Preparedness</h3>
                    <p class="text-slate-600 mb-6">Success hinges on our collective skills. This isn't just a ski trip; it's a test of mountain sense. Everyone must be comfortable with the requirements listed below and ready for collaborative, conservative decision-making.</p>
                    <ul class="space-y-4">
                        <li class="flex items-start"><span class="text-emerald-500 mr-3 mt-1">âœ”</span><div><strong class="font-semibold text-slate-700">AST 2 or Equivalent:</strong> Deep understanding of avalanche phenomena, particularly persistent slab problems.</div></li>
                        <li class="flex items-start"><span class="text-emerald-500 mr-3 mt-1">âœ”</span><div><strong class="font-semibold text-slate-700">Expert Navigation:</strong> Proficiency with GPS (Gaia/CalTopo) AND map & compass is mandatory. The route is unmarked.</div></li>
                        <li class="flex items-start"><span class="text-emerald-500 mr-3 mt-1">âœ”</span><div><strong class="font-semibold text-slate-700">Consecutive Day Fitness:</strong> Ability to travel 4-6 hours a day for 4+ days with a 14-18 kg (30-40 lbs) pack.</div></li>
                        <li class="flex items-start"><span class="text-emerald-500 mr-3 mt-1">âœ”</span><div><strong class="font-semibold text-slate-700">Team Mindset:</strong> Open communication and a shared conservative risk tolerance are non-negotiable.</div></li>
                    </ul>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                     <h3 class="text-xl font-semibold text-slate-800 mb-4">Mid-Winter Conditions</h3>
                     <p class="text-slate-600 mb-6">January and February mean deep cold and short days. This chart illustrates the potential temperature range. Extreme cold degrades battery life on essential electronics (GPS, headlamps), demanding robust backup power solutions.</p>
                    <div class="chart-container">
                        <canvas id="tempChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Route Section -->
        <section id="route" class="content-section">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-900">The Route: Day by Day</h2>
                <p class="mt-2 text-lg text-slate-600 max-w-3xl mx-auto">This section breaks down the standard 4-day itinerary. Each day presents unique challenges, with complexity increasing as we progress. Click on a day to see the details. Remember that these are estimates; conditions on the ground will dictate our pace and decisions.</p>
            </div>
            
            <div class="flex justify-center mb-8">
                <div class="flex space-x-1 bg-slate-200 p-1 rounded-full">
                    <button class="day-tab tab-button px-4 py-2 text-sm font-semibold rounded-full" data-day="day1">Day 1</button>
                    <button class="day-tab tab-button px-4 py-2 text-sm font-semibold rounded-full" data-day="day2">Day 2</button>
                    <button class="day-tab tab-button px-4 py-2 text-sm font-semibold rounded-full" data-day="day3">Day 3</button>
                    <button class="day-tab tab-button px-4 py-2 text-sm font-semibold rounded-full" data-day="day4">Day 4</button>
                </div>
            </div>

            <div id="route-content" class="bg-white p-6 md:p-8 rounded-xl shadow-sm border border-slate-200 min-h-[30rem]">
                <!-- Day content will be injected here -->
            </div>
        </section>

        <!-- Risks Section -->
        <section id="risks" class="content-section">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-900">Risk Management & Contingencies</h2>
                <p class="mt-2 text-lg text-slate-600 max-w-3xl mx-auto">This is the most critical part of the plan. Our safety depends on understanding the primary hazardsâ€”the snowpack and getting lostâ€”and having pre-planned responses. Click each item to expand and review the details.</p>
            </div>
            <div class="max-w-4xl mx-auto space-y-4">
                <div class="accordion-item bg-white border border-slate-200 rounded-xl overflow-hidden">
                    <button class="accordion-header w-full flex justify-between items-center p-5 text-left">
                        <h3 class="text-lg font-semibold text-slate-800">Avalanche Hazard: The Kootenay Snowpack</h3>
                        <span class="accordion-icon text-2xl text-slate-500 transform transition-transform duration-300">ï¼‹</span>
                    </button>
                    <div class="accordion-content">
                        <div class="p-5 pt-0 text-slate-600 space-y-4">
                           <p>The main concern in mid-winter is a <strong>Persistent Slab Problem</strong>. This is when a weak layer (surface hoar or facets) gets buried by new snow. It's like a house of cards waiting to collapse. These layers are tricky because they can be triggered from a distance (e.g., from flat terrain below a slope) and give little warning.</p>
                           <p>A "Considerable" danger rating with this problem means large parts of our route, especially the exposed ridges on Day 2 and the entirety of Day 4, are off-limits. We must act as our own forecasting team: constantly observing for signs of instability (whumpfing, cracking, recent slides) and digging pits to verify the forecast.</p>
                        </div>
                    </div>
                </div>

                <div class="accordion-item bg-white border border-slate-200 rounded-xl overflow-hidden">
                    <button class="accordion-header w-full flex justify-between items-center p-5 text-left">
                        <h3 class="text-lg font-semibold text-slate-800">Navigation Hazard: Finding the Huts</h3>
                        <span class="accordion-icon text-2xl text-slate-500 transform transition-transform duration-300">ï¼‹</span>
                    </button>
                    <div class="accordion-content">
                        <div class="p-5 pt-0 text-slate-600 space-y-4">
                           <p>The route is not marked. Huts can be buried and incredibly difficult to find, even with a GPS. Trip reports are filled with stories of groups searching for hours in the dark, dangerously close to their objective.</p>
                           <p>Our strategy must be multi-layered:
                                <ul class="list-disc list-inside mt-2 space-y-1">
                                    <li><strong>Primary:</strong> Everyone has a phone with Gaia/CalTopo and offline maps downloaded.</li>
                                    <li><strong>Backup:</strong> At least two power banks and one dedicated, cold-resistant GPS unit.</li>
                                    <li><strong>Failsafe:</strong> Two physical maps (82 F/6) and two compasses.</li>
                                </ul>
                           </p>
                           <p class="font-bold">Crucially, we must verify our hut coordinates from the official KMC website before we leave. Using old GPX data is a common and dangerous mistake.</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <h3 class="text-xl font-semibold text-slate-800 mb-4">âœ¨ AI-Powered Daily Risk Checklist</h3>
                    <p class="text-slate-600 mb-6">Turn static hazard info into a dynamic decision-making tool. Select a day to generate a "Go/No-Go" checklist of key observations the team should discuss before heading out.</p>
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button class="risk-checklist-btn bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-full text-sm" data-day="1">Day 1 Checklist</button>
                        <button class="risk-checklist-btn bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-full text-sm" data-day="2">Day 2 Checklist</button>
                        <button class="risk-checklist-btn bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-full text-sm" data-day="3">Day 3 Checklist</button>
                        <button class="risk-checklist-btn bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-full text-sm" data-day="4">Day 4 Checklist</button>
                    </div>
                    <div id="risk-loader" class="gemini-loader text-center p-4">
                        <p class="text-slate-500">âœ¨ Generating checklist...</p>
                    </div>
                    <div id="risk-output" class="gemini-output hidden"></div>
                </div>

                 <div class="accordion-item bg-white border border-slate-200 rounded-xl overflow-hidden">
                    <button class="accordion-header w-full flex justify-between items-center p-5 text-left">
                        <h3 class="text-lg font-semibold text-slate-800">Bail-Out Routes & Emergency Plan</h3>
                        <span class="accordion-icon text-2xl text-slate-500 transform transition-transform duration-300">ï¼‹</span>
                    </button>
                    <div class="accordion-content">
                        <div class="p-5 pt-0 text-slate-600">
                             <p class="mb-4">Knowing when to retreat is a sign of strength. We must have these pre-planned escape routes loaded into our navigation devices.</p>
                             <div class="overflow-x-auto">
                                <table class="w-full text-left border-collapse">
                                    <thead class="bg-slate-100">
                                        <tr>
                                            <th class="p-3 font-semibold">From Hut</th>
                                            <th class="p-3 font-semibold">Destination</th>
                                            <th class="p-3 font-semibold">Considerations</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="border-b border-slate-200"><td class="p-3">Grassy</td><td class="p-3">Bombi Summit (Hwy 3)</td><td class="p-3">Most straightforward. Retrace Day 1.</td></tr>
                                        <tr class="border-b border-slate-200"><td class="p-3">Steed / Copper</td><td class="p-3">Bonnington Dam</td><td class="p-3">Safest in high hazard. Long (~22 km) FSR exit.</td></tr>
                                        <tr><td class="p-3">Copper</td><td class="p-3">Blewett</td><td class="p-3">Can be hazardous. Requires crossing a steep face.</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Gear Section -->
        <section id="gear" class="content-section">
             <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-900">Equipment & Sustenance</h2>
                <p class="mt-2 text-lg text-slate-600 max-w-3xl mx-auto">Proper gear is essential for both safety and comfort. This is a self-sufficient trip. This list highlights key items; a full personal gear list should also be consulted. Everyone must have a full avalanche rescue kit and know how to use it.</p>
            </div>
            <div class="grid lg:grid-cols-3 gap-8 mb-8">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <h3 class="text-xl font-semibold text-slate-800 mb-4">Technical & Ski Gear</h3>
                    <ul class="space-y-3 text-slate-600">
                        <li class="flex"><span class="mr-3 text-lg">â–¡</span>Ski/Splitboard Setup</li>
                        <li class="flex"><span class="mr-3 text-lg">â–¡</span>Climbing Skins (good glue!)</li>
                        <li class="flex"><span class="mr-3 text-lg">â–¡</span>Poles with Powder Baskets</li>
                        <li class="flex bg-yellow-100 p-2 rounded-md"><span class="mr-3 text-lg font-bold text-yellow-700">â– </span><strong class="text-yellow-800">Ski Crampons (Mandatory)</strong></li>
                        <li class="flex"><span class="mr-3 text-lg">â–¡</span>Binding Repair Kit</li>
                    </ul>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <h3 class="text-xl font-semibold text-slate-800 mb-4">Hut & Personal Gear</h3>
                    <ul class="space-y-3 text-slate-600">
                        <li class="flex"><span class="mr-3 text-lg">â–¡</span>Backpack (40-50L)</li>
                        <li class="flex"><span class="mr-3 text-lg">â–¡</span>Sleeping Bag (-10Â°C)</li>
                        <li class="flex"><span class="mr-3 text-lg">â–¡</span>Sleeping Pad (No mattresses)</li>
                        <li class="flex"><span class="mr-3 text-lg">â–¡</span>Headlamp + Extra Batteries</li>
                        <li class="flex"><span class="mr-3 text-lg">â–¡</span>Insulated Water Bottle (No hoses)</li>
                        <li class="flex"><span class="mr-3 text-lg">â–¡</span>First Aid / Blister Kit</li>
                        <li class="flex"><span class="mr-3 text-lg">â–¡</span>Hut Booties / Slippers</li>
                    </ul>
                </div>
                 <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <h3 class="text-xl font-semibold text-slate-800 mb-4">Food & Fuel Plan</h3>
                    <ul class="space-y-3 text-slate-600">
                        <li><strong>Fuel:</strong> We must carry our own 1lb green propane canisters. Plan for <strong>1 canister per 2 people</strong> for the 4-day trip, plus one spare for the group.</li>
                        <li><strong>Food:</strong> Lightweight, high-calorie meals. Repackage into burnable bags to minimize garbage we have to pack out.</li>
                        <li><strong>Water:</strong> We will melt snow for water each evening. This takes significant time and fuel, so we'll need to be efficient.</li>
                    </ul>
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <h3 class="text-xl font-semibold text-slate-800 mb-4">âœ¨ AI-Powered Meal Planner</h3>
                <p class="text-slate-600 mb-4">Simplify one of the hardest parts of trip planning. Enter your group's dietary needs (e.g., vegetarian, gluten-free, no nuts) and let the AI generate a lightweight, high-calorie, 4-day meal plan.</p>
                <div class="flex flex-col sm:flex-row gap-2">
                    <input type="text" id="meal-prefs" class="flex-grow rounded-md border-slate-300 shadow-sm focus:border-orange-500 focus:ring-orange-500" placeholder="e.g., vegetarian, high-calorie, no nuts">
                    <button id="generate-meal-plan" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-md">âœ¨ Generate Meal Plan</button>
                </div>
                <div id="meal-loader" class="gemini-loader text-center p-4">
                    <p class="text-slate-500">âœ¨ Generating your custom meal plan...</p>
                </div>
                <div id="meal-plan-output" class="gemini-output hidden"></div>
            </div>
        </section>

        <!-- Logistics Section -->
        <section id="logistics" class="content-section">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-900">Critical Logistics</h2>
                <p class="mt-2 text-lg text-slate-600 max-w-3xl mx-auto">These are the two logistical pillars we need to solve months in advance: booking the huts and arranging the vehicle shuttle. Both require timely action.</p>
            </div>
            
            <div class="grid lg:grid-cols-2 gap-8">
                <div>
                    <h3 class="text-2xl font-bold text-slate-800 mb-4">KMC Hut Reservations</h3>
                    <div class="space-y-4">
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <h4 class="font-semibold text-lg text-slate-800">Booking Window</h4>
                            <p class="text-slate-600">Bookings open <strong>180 days in advance</strong> on the KMC website. For a Jan/Feb 2026 trip, we need to book in <strong>July/August 2025</strong>. There are NO refunds or changes.</p>
                        </div>
                         <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <h4 class="font-semibold text-lg text-slate-800">Hut Details</h4>
                            <ul class="list-disc list-inside text-slate-600 mt-2">
                                <li>Cost: ~$25/person/night.</li>
                                <li>Capacity: Grassy, Steed, & Copper huts hold 6 people.</li>
                                <li>Amenities: Wood stove, basic pots/pans.</li>
                                <li>Bring: Propane, sleeping pad, sleeping bag.</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div>
                    <h3 class="text-2xl font-bold text-slate-800 mb-4">The Car Shuttle</h3>
                     <div class="space-y-4">
                        <div class="bg-red-100 border-l-4 border-red-500 p-4 rounded-r-lg">
                            <h4 class="font-bold text-red-800">High-Risk Warning!</h4>
                            <p class="text-red-700">Do NOT leave cars unattended at the public trailheads (Bombi Summit or Porto Rico). They are notorious for break-ins, vandalism, and theft. A self-shuttle is strongly discouraged.</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <h4 class="font-semibold text-lg text-slate-800">Recommended Solutions</h4>
                            <ul class="list-disc list-inside text-slate-600 mt-2 space-y-1">
                                <li><strong>Pro Shuttle:</strong> Use a service like West Kootenay Adventure Tours. Most reliable and secure, but most expensive.</li>
                                <li><strong>Hybrid Option:</strong> Park securely at Logden Lodge (near the end point) and take a taxi to the start point. Requires coordination.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

<script>
    const routeData = {
        day1: {
            title: "Day 1: Bombi Summit to Grassy Hut",
            summary: "A straightforward approach day. The goal is to efficiently gain the ridge and reach the first hut. Ski quality is secondary to the objective. The bowl around Grassy Hut offers great skiing for afternoon laps if time permits.",
            steps: [
                { icon: 'ðŸš—', text: 'Start at Bombi Summit parking area on Hwy 3.' },
                { icon: 'ðŸŒ²', text: 'Follow powerline & FSR north for ~6 km.' },
                { icon: 'â†—ï¸', text: 'Ascend spur road through forest to a col.' },
                { icon: 'â†˜ï¸', text: 'Short, potentially steep ski down to the sheltered Grassy Hut.' }
            ],
            hazards: "Low objective hazard, mainly travel on roads and through cutblocks. The main challenge is efficient travel to preserve energy."
        },
        day2: {
            title: "Day 2: Grassy Hut to Steed Hut",
            summary: "A significant step up in complexity. This is a full day of travel with serious elevation gain/loss, ridge walking, and challenging route-finding. Steed Hut is notoriously difficult to locate, especially in poor visibility.",
            steps: [
                { icon: 'ðŸ”¼', text: 'Ascend from Grassy Hut back to the main ridge.' },
                { icon: 'â†”ï¸', text: 'Travel north over Grassy Mountain and sub-peaks.' },
                { icon: '-â—ï¸', text: 'Descend a potentially corniced ridge to a valley road.' },
                { icon: 'ðŸ”¼', text: 'Second major ascent towards Siwash Mountain.' },
                { icon: 'â†˜ï¸', text: 'Contour around Siwash and descend to Steed Hut at a small tarn.' }
            ],
            hazards: "Exposure to corniced ridges and wind-loaded slopes. The primary crux is navigation."
        },
        day3: {
            title: "Day 3: Steed Hut to Copper Hut",
            summary: "A day of travel through the heart of the Bonnington Range. Expect to cross ski and snowmobile tracks as this area is shared with a heli-ski operation and local riders. Copper hut is often visible on the final approach.",
            steps: [
                { icon: 'ðŸ”¼', text: 'Travel north from Steed Hut, following ridges east of Siwash Mtn.' },
                { icon: 'â†”ï¸', text: 'Undulating terrain through several drainages.' },
                { icon: 'ðŸ¤”', text: 'Route choice: follow a prominent ridge system (more aesthetic) or a lower contour through cutblocks.' },
                { icon: 'â†˜ï¸', text: 'Final approach to Copper Hut, which sits below the main ridge.' }
            ],
            hazards: "Less technical than Day 2, but navigation can still be tricky. Be aware of overhead heli-skiing and other groups."
        },
        day4: {
            title: "Day 4: Copper Hut to Porto Rico Road",
            summary: "The technical and psychological crux of the traverse. A long, committing day on an exposed, demanding alpine ridge. This day REQUIRES stable snow, good weather, and confident mountain travel skills. It cannot be attempted in high hazard or poor visibility.",
            steps: [
                { icon: 'ðŸ”¼', text: 'Climb from Copper Hut to the ridge south of Copper Mountain.' },
                { icon: '-â—ï¸', text: 'Traverse the spectacular but exposed ridge over Territory & Colony Peaks.' },
                { icon: 'ðŸ¥¾', text: 'Mandatory, very exposed bootpack along the crest to Empire Peak.' },
                { icon: 'â†˜ï¸', text: 'Long ski descent from Empire Peak to Barrett Lake.' },
                { icon: 'ðŸ›£ï¸', text: 'Exit via Barrett Creek FSR to the vehicle at Porto Rico Road.' }
            ],
            hazards: "Highest objective hazard. Constant cornice threat. Severe fall potential on the bootpack section. Slopes below the ridge can be dangerously wind-loaded."
        }
    };

    function renderRouteContent(day) {
        const data = routeData[day];
        const contentDiv = document.getElementById('route-content');
        let stepsHtml = data.steps.map(step => `
            <li class="flex items-start">
                <span class="text-2xl w-8 text-center mr-4">${step.icon}</span>
                <span class="flex-1 text-slate-600 pt-1">${step.text}</span>
            </li>
        `).join('');

        contentDiv.innerHTML = `
            <h3 class="text-2xl font-bold text-slate-900 mb-2">${data.title}</h3>
            <p class="text-slate-600 mb-6">${data.summary}</p>
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h4 class="font-semibold text-slate-800 mb-4">Route Breakdown</h4>
                    <ul class="space-y-4">${stepsHtml}</ul>
                </div>
                <div class="bg-amber-50 border border-amber-200 p-4 rounded-lg">
                    <h4 class="font-semibold text-amber-800 mb-2">Key Hazards & Decision Points</h4>
                    <p class="text-amber-700">${data.hazards}</p>
                </div>
            </div>
        `;
    }

    async function callGemini(prompt) {
        const apiKey = ""; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
        
        const payload = {
            contents: [{
                role: "user",
                parts: [{ text: prompt }]
            }]
        };

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const result = await response.json();
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                return result.candidates[0].content.parts[0].text;
            } else {
                console.error("Gemini API response structure unexpected:", result);
                return "Sorry, I couldn't generate a response right now. Please check the console for details.";
            }
        } catch (error) {
            console.error("Error calling Gemini API:", error);
            return "An error occurred while contacting the AI. Please try again later.";
        }
    }


    document.addEventListener('DOMContentLoaded', function() {
        const navLinks = document.querySelectorAll('.nav-link');
        const mobileNav = document.getElementById('mobile-nav');
        const contentSections = document.querySelectorAll('.content-section');

        function setActiveSection(hash) {
            navLinks.forEach(link => {
                if (link.getAttribute('href') === hash) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });

            contentSections.forEach(section => {
                if ('#' + section.id === hash) {
                    section.classList.add('active');
                } else {
                    section.classList.remove('active');
                }
            });
            
            if (mobileNav.value !== hash) {
                mobileNav.value = hash;
            }
        }

        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const hash = this.getAttribute('href');
                window.location.hash = hash;
            });
        });
        
        mobileNav.addEventListener('change', function() {
            window.location.hash = this.value;
        });

        window.addEventListener('hashchange', () => {
             setActiveSection(window.location.hash || '#dashboard');
        });

        // Set initial state
        setActiveSection(window.location.hash || '#dashboard');

        // Chart.js Temp Chart
        const ctx = document.getElementById('tempChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['January / February'],
                datasets: [{
                    label: 'Typical Low Â°C',
                    data: [-20],
                    backgroundColor: 'rgba(59, 130, 246, 0.6)',
                    borderColor: 'rgba(59, 130, 246, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Typical High Â°C',
                    data: [2],
                    backgroundColor: 'rgba(249, 115, 22, 0.6)',
                    borderColor: 'rgba(249, 115, 22, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        title: {
                            display: true,
                            text: 'Temperature (Â°C)'
                        }
                    }
                },
                plugins: {
                    legend: { position: 'bottom' },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.dataset.label}: ${context.raw}Â°C`;
                            }
                        }
                    }
                }
            }
        });

        // Route Tabs
        const dayTabs = document.querySelectorAll('.day-tab');
        dayTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                dayTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                renderRouteContent(this.dataset.day);
            });
        });

        // Accordion
        const accordionItems = document.querySelectorAll('.accordion-item');
        accordionItems.forEach(item => {
            const header = item.querySelector('.accordion-header');
            header.addEventListener('click', () => {
                const content = item.querySelector('.accordion-content');
                const icon = item.querySelector('.accordion-icon');
                if (content.style.maxHeight) {
                    content.style.maxHeight = null;
                    icon.textContent = 'ï¼‹';
                    icon.classList.remove('rotate-45');
                } else {
                    content.style.maxHeight = content.scrollHeight + "px";
                    icon.textContent = 'âˆ’';
                } 
            });
        });
        
        // Gemini Meal Planner
        const generateMealBtn = document.getElementById('generate-meal-plan');
        const mealPrefsInput = document.getElementById('meal-prefs');
        const mealLoader = document.getElementById('meal-loader');
        const mealOutput = document.getElementById('meal-plan-output');

        generateMealBtn.addEventListener('click', async () => {
            const prefs = mealPrefsInput.value || 'no specific preferences';
            const prompt = `Create a lightweight, high-calorie, 4-day backcountry ski touring meal plan. The plan should be for one person and focus on food that requires minimal cooking. The user has specified the following dietary needs: ${prefs}. Format the output with clear headings for each day (Day 1, Day 2, etc.) and subheadings for Breakfast, Lunch, Dinner, and Snacks.`;
            
            mealLoader.style.display = 'block';
            mealOutput.classList.add('hidden');
            
            const response = await callGemini(prompt);
            
            mealOutput.textContent = response;
            mealLoader.style.display = 'none';
            mealOutput.classList.remove('hidden');
        });

        // Gemini Risk Checklist
        const riskChecklistBtns = document.querySelectorAll('.risk-checklist-btn');
        const riskLoader = document.getElementById('risk-loader');
        const riskOutput = document.getElementById('risk-output');

        riskChecklistBtns.forEach(btn => {
            btn.addEventListener('click', async () => {
                const day = btn.dataset.day;
                const dayData = routeData[`day${day}`];
                const prompt = `I am planning Day ${day} of the Bonnington Ski Traverse. The key hazards for this day are: "${dayData.hazards}". Create a concise "Go/No-Go Checklist" for my team to discuss in the morning before we leave the hut. The checklist should be a series of bullet points focusing on actionable observations related to weather, snowpack, group factors, and the specific hazards for the day. Frame it as a practical tool for making a safe decision.`;
                
                riskLoader.style.display = 'block';
                riskOutput.classList.add('hidden');

                const response = await callGemini(prompt);

                riskOutput.textContent = response;
                riskLoader.style.display = 'none';
                riskOutput.classList.remove('hidden');
            });
        });


        // Initialize route content
        document.querySelector('.day-tab[data-day="day1"]').classList.add('active');
        renderRouteContent('day1');
    });
</script>

</body>
</html>
